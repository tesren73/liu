(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"0db7":function(t,e,a){},2718:function(t,e,a){"use strict";(function(t,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(a("a34a")),i=a("c4c8"),c=a("2b74"),s=o(a("8f09")),u=a("802d");function o(t){return t&&t.__esModule?t:{default:t}}function l(t){return h(t)||d(t)||p()}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function d(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function h(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function f(t,e,a,r,n,i,c){try{var s=t[i](c),u=s.value}catch(o){return void a(o)}s.done?e(u):Promise.resolve(u).then(r,n)}function g(t){return function(){var e=this,a=arguments;return new Promise((function(r,n){var i=t.apply(e,a);function c(t){f(i,r,n,c,s,"next",t)}function s(t){f(i,r,n,c,s,"throw",t)}c(void 0)}))}}var _=function(){return a.e("components/rf-number-box/index").then(a.bind(null,"b279"))},m=function(){return a.e("components/rf-rate/rf-rate").then(a.bind(null,"6c8d"))},v=function(){return a.e("components/rf-badge/rf-badge").then(a.bind(null,"bf8c"))},b={components:{rfBadge:v,rfRate:m,rfNumberBox:_},filters:{formatRichText:function(t){if(t){var e=t.replace(/<img[^>]*>/gi,(function(t,e){return t=t.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),t=t.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),t=t.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),t}));return e=e.replace(/style="[^"]+"/gi,(function(t,e){return t=t.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),t})),e=e.replace(/<br[^>]*\/>/gi,""),e=e.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),e}return"暂无商品详情"},time:function(t){return(0,s.default)(1e3*t).format("YYYY-MM-DD HH:mm")},discountFilter:function(t){return 10*t.toFixed(2)},maxBuyFilter:function(t){return 0===parseInt(t,10)?"不限购":"限购：".concat(t)},pointExchangeTypeFilter:function(t){var e=["","非积分兑换","积分加现金","积分兑换或直接购买","只支持积分兑换"];return e[parseInt(t,10)]},integralGiveTypeFilter:function(t){var e=["固定积分","百分比"];return e[parseInt(t,10)]},givePointFilter:function(t){return 1===parseInt(t.integral_give_type,10)?"".concat(Math.round(parseInt(t.give_point,10)/100*parseInt(t.minSkuPrice,10))," 积分"):parseInt(t.integral_give_type,10)}},data:function(){return{serviceClass:"none",ladderPreferentialClass:"none",attributeValueClass:"none",cartType:null,maskState:0,couponList:[],productDetail:{},styleObject:{},showTypeImage:null,specClass:"none",specSelected:[],favorite:!1,shareList:[],currentStock:null,currentSkuPrice:null,specList:[],specChildList:[],cartCount:1,product_id:null,evaluateList:[],token:null,cartNum:null,loading:!0,errorInfo:""}},computed:{buyBtnDisabled:function(){return 0==(this.currentStock||this.productDetail.stock)},addCartBtnDisabled:function(){return 2==this.productDetail.point_exchange_type||4==this.productDetail.point_exchange_type||0==(this.currentStock||this.productDetail.stock)||1==this.productDetail.is_virtual}},onLoad:function(){var t=g(n.default.mark((function t(e){var a=this;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.initData(e.id),this.specList.forEach((function(t){var e=!0,r=!1,n=void 0;try{for(var i,c=a.specChildList[Symbol.iterator]();!(e=(i=c.next()).done);e=!0){var s=i.value;if(s.pid===t.id){a.$set(s,"selected",!0),a.specSelected.push(s);break}}}catch(u){r=!0,n=u}finally{try{e||null==c.return||c.return()}finally{if(r)throw n}}})),this.product_id=e.id;case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onShareAppMessage:function(t){},methods:{navTo:function(e){this.token?t.navigateTo({url:e}):t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&t.reLaunch({url:"/pages/public/logintype"})}})},showService:function(){this.productDetail.tags&&0===this.productDetail.tags.length||(this.serviceClass="show")},showLadderPreferential:function(){0!==this.productDetail.ladderPreferential.length&&(this.ladderPreferentialClass="show")},showAttributeValue:function(){0!==this.productDetail.attributeValue.length&&(this.attributeValueClass="show")},shareToH5:function(){this.$api.msg("请复制连接进行分享")},hideService:function(){var t=this;this.serviceClass="hide",this.ladderPreferentialClass="hide",this.attributeValueClass="hide",setTimeout((function(){t.serviceClass="none",t.ladderPreferentialClass="none",t.attributeValueClass="none"}),200)},getCoupon:function(){var e=g(n.default.mark((function e(a){var i=this;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.token){e.next=4;break}return this.maskState=0,t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}}),e.abrupt("return");case 4:return e.next=6,this.$post("".concat(u.couponReceive),{id:a.id}).then((function(){i.$api.msg("领取成功"),i.maskState=0})).catch((function(t){i.maskState=0,console.log(r(t," at pages/product/product.vue:623"))}));case 6:case"end":return e.stop()}}),e,this)})));function a(t){return e.apply(this,arguments)}return a}(),toEvaluateList:function(){t.navigateTo({url:"/pages/order/evaluation/list?comment_num=".concat(this.productDetail.comment_num,"&evaluateStat=").concat(JSON.stringify(this.productDetail.evaluateStat))})},numberChange:function(t){this.cartCount=t.number},toggleMask:function(t){var e=this;if(this.productDetail.id){var a="show"===t?10:300,r="show"===t?1:0;this.maskState=2,setTimeout((function(){e.maskState=r}),a)}},initData:function(){var e=g(n.default.mark((function e(a){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.token=t.getStorageSync("accessToken"),this.cartNum=t.getStorageSync("cartNum"),e.next=4,this.getProductDetail(a);case 4:case"end":return e.stop()}}),e,this)})));function a(t){return e.apply(this,arguments)}return a}(),getProductDetail:function(){var t=g(n.default.mark((function t(e){var a=this;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$get("".concat(i.productDetail),{id:e}).then(function(){var t=g(n.default.mark((function t(e){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.loading=!1,a.productDetail=e.data,t.next=4,e.data.evaluate;case 4:a.evaluateList=t.sent,a.favorite=!!a.productDetail.myCollect,a.specList=a.productDetail.base_attribute_format,a.specList.forEach((function(t){a.specChildList=[].concat(l(a.specChildList),l(t.value))})),a.specSelected=[],e.data.base_attribute_format.forEach((function(t){t.value[0].selected=!0,a.specSelected.push(t.value[0])})),r=[],a.specSelected.forEach((function(t){r.push(t.base_spec_value_id)})),a.productDetail.sku.forEach((function(t){if(t.data===r.join("-"))return a.currentStock=t.stock,void(a.currentSkuPrice=t.price)}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){a.loading=!1,a.errorInfo=t}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),toggleSpec:function(){var e=this;if(this.productDetail.id)if("show"===this.specClass){if(!this.token)return this.specClass="none",void t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}});if(this.specSelected.length<this.productDetail.base_attribute_format.length)return void this.$api.msg("请先选择规格");if("cart"===this.cartType){if(this.cartType=null,0==this.currentStock)return void this.$api.msg("库存不足");this.handleCartItemCreate()}else if("buy"===this.cartType){if(this.cartType=null,0==this.currentStock)return void this.$api.msg("库存不足");this.buy()}this.specClass="hide",setTimeout((function(){e.specClass="none"}),250)}else"none"===this.specClass&&(this.specClass="show")},hideSpec:function(){var t=this;this.specClass="hide",setTimeout((function(){t.specClass="none"}),250)},handleCartItemCreate:function(){var e=g(n.default.mark((function e(){var a,c,s=this;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(c=null,1!==this.productDetail.sku.length){e.next=5;break}a=this.productDetail.sku[0].id,e.next=31;break;case 5:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=11;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 11:c="".concat(this.specSelected[0].base_spec_value_id);case 12:e.next=30;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=23;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:c="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id);case 21:e.next=30;break;case 23:if(3!==this.productDetail.base_attribute_format.length){e.next=30;break}if(!(this.specSelected.length<3)){e.next=29;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 29:c="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id);case 30:this.productDetail&&this.productDetail.sku.forEach((function(t){t.data!==c||(a=t.id)}));case 31:return e.next=33,this.$post("".concat(i.cartItemCreate),{sku_id:a,num:this.cartCount}).then(function(){var e=g(n.default.mark((function e(a){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.$get("".concat(i.cartItemCount)).then((function(e){t.setStorageSync("cartNum",e.data),s.cartNum=e.data}));case 2:s.$api.msg("添加成功，在购物车等");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.log(r(t," at pages/product/product.vue:804"))}));case 33:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}(),selectSpec:function(t,e,a){var r=this,n=this.specChildList;n.forEach((function(t){t.base_spec_id===e&&r.$set(t,"selected",!1)})),3===parseInt(a,10)&&(this.showTypeImage=n[t].data),2===parseInt(a,10)&&(this.styleObject={color:n[t].data}),this.$set(n[t],"selected",!0),this.specSelected=[],n.forEach((function(t){!0===t.selected&&r.specSelected.push(t)}));var i=[];this.specSelected.forEach((function(t){i.push(t.base_spec_value_id)})),this.productDetail.sku.forEach((function(t){if(t.data===i.join("-"))return r.currentStock=t.stock,void(r.currentSkuPrice=t.price)}))},share:function(t){return"button"===t.from&&console.log(r(t.target," at pages/product/product.vue:853")),{title:"自定义分享标题",path:"/pages/test/test?id=123"}},toFavorite:function(){var e=g(n.default.mark((function e(){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.productDetail.id){e.next=2;break}return e.abrupt("return");case 2:this.token?this.favorite?this.handleCollectDel():this.handleCollectCreate():(this.specClass="none",t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/logintype"}))}}));case 3:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}(),handleCollectCreate:function(){var t=g(n.default.mark((function t(){var e=this;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$post("".concat(c.collectCreate),{topic_id:this.product_id,topic_type:"product"}).then((function(t){e.favorite=!e.favorite,e.$api.msg("收藏成功")})).catch((function(t){console.log(r(t," at pages/product/product.vue:899"))}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleCollectDel:function(){var t=g(n.default.mark((function t(){var e=this;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$del("".concat(c.collectDel,"?id=").concat(this.productDetail.myCollect.id)).then((function(t){e.favorite=!e.favorite,e.$api.msg("取消收藏成功")})).catch((function(t){console.log(r(t," at pages/product/product.vue:913"))}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),buy:function(){var e=g(n.default.mark((function e(){var a,r,i,c;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(1!==this.productDetail.sku.length){e.next=4;break}a=this.productDetail.sku[0].id,e.next=33;break;case 4:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=10;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 10:r="".concat(this.specSelected[0].base_spec_value_id),"".concat(this.specSelected[0].title);case 12:e.next=32;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=24;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title);case 22:e.next=32;break;case 24:if(3!==this.productDetail.base_attribute_format.length){e.next=32;break}if(!(this.specSelected.length<3)){e.next=30;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 30:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title," ").concat(this.specSelected[2].title);case 32:this.productDetail&&this.productDetail.sku.forEach((function(t){t.data!==r||(a=t.id)}));case 33:i={},c={},c.sku_id=a,c.num=this.cartCount,2==this.productDetail.point_exchange_type||4==this.productDetail.point_exchange_type?i.type="point_exchange":i.type="buy_now",i.data=JSON.stringify(c),t.navigateTo({url:"/pages/order/create/order?data=".concat(JSON.stringify(i))});case 40:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}(),addCart:function(t){this.productDetail.id&&(this.specClass="show",this.cartType=t)},stopPrevent:function(){}}};e.default=b}).call(this,a("6e42")["default"],a("0de9")["default"])},abde:function(t,e,a){"use strict";var r=a("0db7"),n=a.n(r);n.a},b675:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=(t._self._c,parseFloat(t.productDetail.market_price)),r=parseFloat(t.productDetail.price),n=parseFloat(t.productDetail.market_price),i=parseFloat(t.productDetail.price),c=t._f("discountFilter")((t.currentSkuPrice||t.productDetail.price)/t.productDetail.market_price),s=t._f("maxBuyFilter")(t.productDetail.max_buy),u=t._f("pointExchangeTypeFilter")(t.productDetail.point_exchange_type),o=t._f("integralGiveTypeFilter")(t.productDetail.integral_give_type),l=t._f("givePointFilter")(t.productDetail),p=t.__map(t.productDetail.ladderPreferential,(function(e,a){var r=parseInt(e.type,10),n=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m4:r,m5:n,m6:i}})),d=t._f("time")(t.productDetail.evaluate&&t.productDetail.evaluate[0]&&t.productDetail.evaluate[0].created_at),h=t._f("formatRichText")(t.productDetail.intro),f=t.__map(t.productDetail.ladderPreferential,(function(e,a){var r=parseInt(e.type,10),n=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m7:r,m8:n,m9:i}})),g=t.__map(t.specList,(function(e,a){var r=parseInt(e.show_type),n=parseInt(e.show_type),i=parseInt(e.show_type),c=parseInt(e.show_type);return{$orig:t.__get_orig(e),m10:r,m11:n,m12:i,m13:c}})),_=parseInt(t.currentStock||t.productDetail.stock,10),m=t.__map(t.productDetail.canReceiveCoupon,(function(e,a){var r=parseInt(e.term_of_validity_type,10),n=t._f("time")(e.start_time),i=t._f("time")(e.end_time),c=parseInt(e.range_type,10);return{$orig:t.__get_orig(e),m15:r,f7:n,f8:i,m16:c}}));t.$mp.data=Object.assign({},{$root:{m0:a,m1:r,m2:n,m3:i,f0:c,f1:s,f2:u,f3:o,f4:l,l0:p,f5:d,f6:h,l1:f,l2:g,m14:_,l3:m}})},n=[];a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return n}))},c2aa:function(t,e,a){"use strict";(function(t){a("6cdc"),a("921b");r(a("66fd"));var e=r(a("ee53"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},dfd6:function(t,e,a){"use strict";a.r(e);var r=a("2718"),n=a.n(r);for(var i in r)"default"!==i&&function(t){a.d(e,t,(function(){return r[t]}))}(i);e["default"]=n.a},ee53:function(t,e,a){"use strict";a.r(e);var r=a("b675"),n=a("dfd6");for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);a("abde");var c=a("2877"),s=Object(c["a"])(n["default"],r["a"],r["b"],!1,null,"064c427e",null);e["default"]=s.exports}},[["c2aa","common/runtime","common/vendor"]]]);